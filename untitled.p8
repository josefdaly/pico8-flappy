pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
  player = {}
  player.x = 30
  player.y = 0
  player.spr_no = 1
  player.vel = 0
  player.max_vel = 100
  player.min_vel = -3

		pipes = {}
		add(pipes, create_pipe())
		last_pipe_added = flr(time())
  gravity = .2
  jump_vel = -.8
end

function _update()
  if btn(4) then
    accel(player, jump_vel)
  else
    accel(player, gravity)
  end
  fall(player)
  handle_pipe_creation()
end

function _draw()
		cls()
	 map(0, 0)
  draw_item(player)
  foreach(pipes,draw_pipe)
  foreach(pipes,move_pipe)
end
-->8
function draw_item(item)
  spr(
    item.spr_no,
    item.x,
    item.y
   )
end

function fall(item)
  item.y += item.vel
end

function accel(item, delta)
  if not ((item.vel + delta) < 
    item.min_vel)
  then
		  item.vel += delta
  end
end

-->8
function create_pipe()
  local pipe = {}
  pipe.spr_no = 9
  pipe.x = 120
  pipe.gap = 2 + flr(rnd(12))
  pipe.speed = .5
  return pipe
end

function draw_pipe(p)
  for i=0,15 do
  		if i==p.gap or i-1==p.gap then
  		else
      spr(p.spr_no, p.x, i*8)
    end
  end
end

function move_pipe(p)
  p.x-=p.speed
end

function handle_pipe_creation()
		local delta = flr(time()) - last_pipe_added
		local range = 10 - delta
		if delta > 2 and flr(rnd(range)) == 0
		then
		  add(pipes, create_pipe())
				last_pipe_added = flr(time())
		end
end
	
  
__gfx__
0000000000000000bbbbbbbbbbbbb3bb00000000000000000000000000000000000000003b6556b3000000000000000000000000000000000000000000000000
00000000000011103bb33b334343bbbb00000000000007000000000000700000007000003b6556b3000000000000000000000000000000000000000000000000
00700700005511a043b44b34444334b300000000000000000000000000000000000000003b6556b3000000000000000000000000000000000000000000000000
0007700055533300433443444444444400000000000000000000000000000000000000003b6556b3000000000000000000000000000000000000000000000000
0007700005500000444444444454444400000000000000000000000000000000000070003b6556b3000000000000000000000000000000000000000000000000
0070070000500000444564444554445400000000000000000000000000000000070000003b6556b3000000000000000000000000000000000000000000000000
0000000000000000444454444564446400000000070000000000070000000000000000073b6556b3000000000000000000000000000000000000000000000000
0000000000000000444444444444444400000000000000000000000000000000000000003b6556b3000000000000000000000000000000000000000000000000
__map__
0804040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040704040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404080404040404070404040704040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404070404040407040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0407040404080804040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404080804040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404080404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
