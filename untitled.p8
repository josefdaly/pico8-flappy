pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function set_game()
  player = {}
  player.score = 0
  player.x = 30
  player.y = 56
  player.up_spr = 18
  player.down_spr = 19
  player.straight_spr = 17
  player.vel = 0
  player.max_vel = 100
  player.min_vel = -3
  player.collisionheigth=6
  player.collisionwidth=6
  pipes = {}
  game_start=false
  game_over=false
		add(pipes, create_pipe())
		last_pipe_added = flr(time())
end

function _init()
  set_game()
  gravity = .15
  jump_vel = -.6
end

function _update()
  if btn(4) then
    if not game_start
      and not game_over
    then
      game_start=true
    elseif game_over then
      set_game()
    end
  end
  if game_start then
    if btn(4) then
      sfx(0)
    end
    
    if btn(4) then
      accel(player, jump_vel)
    else
      accel(player, gravity)
    end
    fall(player)
    handle_pipe_creation()
    foreach(pipes,move_pipe)
    
    if cmap(player) then
      game_over=true
      game_start=false
    end
    
    if game_over then
      sfx(1)
    end
  end
end

function _draw()
		cls()
	 map(0, 0)
  draw_player(player)
  foreach(pipes,draw_pipe)
  print(player.score)
end
-->8
function draw_player(p)
  local sprite_no
  if player.vel > .5 then
    sprite_no = player.down_spr
  elseif player.vel < -.5 then
    sprite_no = player.up_spr
  else
    sprite_no = player.straight_spr
  end
  
  spr(
    sprite_no,
    player.x,
    player.y
   )
end

function fall(item)
  item.y += item.vel
end

function accel(item, delta)
  if not ((item.vel + delta) < 
    item.min_vel)
  then
		  item.vel += delta
  end
end

function cmap(o)
  // environment collision
  local x1=o.x/8
  local y1=o.y/8
  local x2=(o.x+7)/8
  local y2=(o.y+7)/8
  local a=fget(mget(x1,y1),0)
  local b=fget(mget(x1,y2),0)
  local c=fget(mget(x2,y2),0)
  local d=fget(mget(x2,y1),0)

  return a or b or c or d
end

function collide(a, b)
	if (a.collisionwidth == nil)  a.collisionwidth = 8 
	if (a.collisionheigth == nil)  a.collisionheigth = 8 
	if (b.collisionwidth == nil)  b.collisionwidth = 8 
	if (b.collisionheigth == nil)  b.collisionheigth = 8 

	local aleft = a.x
	local atop = a.y
	local arigth = a.x+a.collisionwidth-1
	local abottom = a.y+a.collisionheigth-1

	local bleft = b.x
	local btop = b.y
	local brigth = b.x+b.collisionwidth-1
	local bbottom = b.y+b.collisionheigth-1

	if (atop > bbottom)  return false 
	if (btop > abottom)  return false 
	if (aleft > brigth)  return false 
	if (bleft > arigth)  return false 

	return true
end


-->8
function create_pipe()
  local pipe = {}
  pipe.spr_no = 9
  pipe.x = 120
  pipe.gap = 2 + flr(rnd(12))
  pipe.speed = .5
  pipe.scored = false
  return pipe
end

function draw_pipe(p)
  local pipe = {}
  pipe.x = p.x
  for i=0,14 do
  		if i==p.gap or i-1==p.gap then
  		else
      spr(p.spr_no, p.x, i*8)
      pipe.y = i*8
      if collide(player, pipe) then
        game_start=false
        game_over=true
      end
    end
  end
end

function move_pipe(p)
  p.x-=p.speed
  if p.x < player.x-8 
  		and not p.scored
  then
    player.score+=1
    p.scored=true
  end
end

function handle_pipe_creation()
		local delta = flr(time()) - last_pipe_added
		local range = 10 - delta
		if delta > 2 and flr(rnd(range)) == 0
		then
		  add(pipes, create_pipe())
				last_pipe_added = flr(time())
		end
end
	
  
__gfx__
0000000000000000bbbbbbbbbbbbb3bb00000000000000000000000000000000000000003b6556b3000000000000000000000000000000000000000000000000
00000000000011103bb33b334343bbbb00000000000007000000000000700000007000003b6556b3000000000000000000000000000000000000000000000000
00700700405511aa43b44b34444334b300000000000000000000000000000000000000003b6556b3000000000000000000000000000000000000000000000000
0007700005533300433443444444444400000000000000000000000000000000000000003b6556b3000000000000000000000000000000000000000000000000
0007700000555500444444444454444400000000000000000000000000000000000070003b6556b3000000000000000000000000000000000000000000000000
0070070000005500444564444554445400000000000000000000000000000000070000003b6556b3000000000000000000000000000000000000000000000000
0000000000000500444454444564446400000000070000000000070000000000000000073b6556b3000000000000000000000000000000000000000000000000
0000000000000000444444444444444400000000000000000000000000000000000000003b6556b3000000000000000000000000000000000000000000000000
00000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000001110000011a004500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000405511aa0005110005550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055553000555530000555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000005500004055000005531100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000050000000500000000011a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
6660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
6060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
6060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
6060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
6660700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000007000000000000000000000000000000000000000000000007000000000000000000000000000000070000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000007000000000000000000000000000000000000000700000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000700000000000000000000000000000007000000070000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000070000000700000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000070000000700000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000070000000700000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000111000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
000000000000000000000000000000405511aa00000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000555530000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000055000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007000000070000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000000700000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000000700000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000000700000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003b6556b3
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbb3bbbbbbb3bbbbbbb3bbbbbbb3bbbbbbb3bbbbbbb3bbbbbbbbbbbbbbb3bbbbbbb3bbbbbbb3bbbbbbb3bbbbbbb3bbbbbbb3bbbbbbb3bbbbbbb3bbbbbbb3bb
4343bbbb4343bbbb4343bbbb4343bbbb4343bbbb4343bbbb3bb33b334343bbbb4343bbbb4343bbbb4343bbbb4343bbbb4343bbbb4343bbbb4343bbbb4343bbbb
444334b3444334b3444334b3444334b3444334b3444334b343b44b34444334b3444334b3444334b3444334b3444334b3444334b3444334b3444334b3444334b3
44444444444444444444444444444444444444444444444443344344444444444444444444444444444444444444444444444444444444444444444444444444
44544444445444444454444444544444445444444454444444444444445444444454444444544444445444444454444444544444445444444454444444544444
45544454455444544554445445544454455444544554445444456444455444544554445445544454455444544554445445544454455444544554445445544454
45644464456444644564446445644464456444644564446444445444456444644564446445644464456444644564446445644464456444644564446445644464
44444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444444

__gff__
0000010100000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0804040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040704040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404080404040404070404040704040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404070404040407040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0407040404080804040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404080804040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404080404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404040404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0404040404000404040404040404040400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0303030303030203030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000252525000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000000000000003a25037250332502f2502b25028250262502425022250202501f2501d2501c2501a25019250182501825017250172501725018250182501a2501c250222502b2503a250000000000000000
001000000000000000000003c2503c2503c2503b2503a25039250372503625033250312502e2502b25028250232501e250192500c250000000000000000000000000000000000000000000000000000000000000
